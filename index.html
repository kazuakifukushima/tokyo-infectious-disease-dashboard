<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±äº¬éƒ½æ„ŸæŸ“ç—‡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - ãƒ‡ãƒ¢ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f9fafb;
            color: #374151;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .sidebar-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }
        
        .nav-item {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .nav-item:hover {
            background-color: #f3f4f6;
        }
        
        .nav-item.active {
            background-color: #dbeafe;
            border-right: 3px solid #3b82f6;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: white;
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        
        .header-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .header-subtitle {
            color: #6b7280;
        }
        
        .content {
            flex: 1;
            padding: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }
        
        .chart-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .chart-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1f2937;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #6b7280;
        }
        
        .error {
            color: #dc2626;
            text-align: center;
            padding: 2rem;
        }
        
        .disease-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
        }
        
        .disease-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            justify-content: space-between;
        }
        
        .disease-item:last-child {
            border-bottom: none;
        }
        
        .disease-name {
            font-weight: 500;
        }
        
        .disease-count {
            color: #6b7280;
            font-family: monospace;
        }
        
        .filter-section {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            align-items: end;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .form-select {
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: white;
            font-size: 0.875rem;
        }
        
        .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2563eb;
        }
        
        .btn-primary:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .data-table th {
            background-color: #f9fafb;
            font-weight: 600;
            color: #374151;
        }
        
        .data-table tr:hover {
            background-color: #f9fafb;
        }
        
        .metric-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .metric-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.875rem;
            font-weight: 700;
            color: #3b82f6;
        }
        
        .metric-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">ğŸ¥ IDSC Dashboard</div>
                <div style="font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem;">æ„ŸæŸ“ç—‡ãƒ‡ãƒ¼ã‚¿åˆ†æ</div>
            </div>
            <nav>
                <div style="padding: 0.5rem 1.5rem; font-size: 0.75rem; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.05em;">å…¨æ•°æŠŠæ¡ç–¾æ‚£</div>
                <div class="nav-item active" data-view="overview">ğŸ“Š æ¦‚æ³</div>
                <div class="nav-item" data-view="diseases">ğŸ¦  ç–¾ç—…åˆ¥åˆ†æ</div>
                <div class="nav-item" data-view="categories">ğŸ“‹ åˆ†é¡åˆ¥çµ±è¨ˆ</div>
                <div class="nav-item" data-view="trends">ğŸ“ˆ æ™‚ç³»åˆ—åˆ†æ</div>
                
                <div style="padding: 0.5rem 1.5rem; font-size: 0.75rem; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.05em; margin-top: 1rem; border-top: 1px solid #e5e7eb;">å®šç‚¹ã‚µãƒ¼ãƒ™ã‚¤ãƒ©ãƒ³ã‚¹</div>
                <div class="nav-item" data-view="sentinel-overview">ğŸ¥ å®šç‚¹æ¦‚æ³</div>
                <div class="nav-item" data-view="sentinel-diseases">ğŸ¦  å®šç‚¹ç–¾ç—…åˆ†æ</div>
                <div class="nav-item" data-view="sentinel-geographic">ğŸ—ºï¸ åœ°åŸŸåˆ¥åˆ†æ</div>
            </nav>
        </div>
        
        <div class="main-content">
            <div class="header">
                <div class="header-title">æ±äº¬éƒ½æ„ŸæŸ“ç—‡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
                <div class="header-subtitle" id="data-period">ãƒ‡ãƒ¼ã‚¿æœŸé–“: 2000å¹´ ï½ 2025å¹´</div>
            </div>
            
            <div class="content" id="main-content">
                <div class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        let summaryData = null;
        let currentView = 'overview';
        let diseaseList = [];
        let currentDiseaseData = null;
        let isSeasonalMode = false;
        let seasonalData = null;
        let mainDataset = null; // å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ
        let sentinelDataset = null; // å®šç‚¹ã‚µãƒ¼ãƒ™ã‚¤ãƒ©ãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿
        let sentinelSummaryData = null;
        let sentinelDiseaseList = [];
        let sentinelCurrentData = null; // ç¾åœ¨åˆ†æä¸­ã®ãƒ‡ãƒ¼ã‚¿
        let sentinelIsSeasonalMode = false; // å­£ç¯€æ€§æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰
        let sentinelSeasonalData = null; // å­£ç¯€æ€§æ¯”è¼ƒãƒ‡ãƒ¼ã‚¿

        // é™çš„ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
        async function fetchStaticData(filename) {
            try {
                // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ãŸã‚ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¿½åŠ 
                const cacheBuster = new Date().getTime();
                const response = await fetch(`./data/${filename}?v=${cacheBuster}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                if (filename.endsWith('.json')) {
                    return await response.json();
                } else {
                    return await response.text();
                }
            } catch (error) {
                console.error('Data Loading Error:', error);
                throw error;
            }
        }

        // CSVã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹é–¢æ•°
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                const row = {};
                headers.forEach((header, index) => {
                    const value = values[index]?.trim() || '';
                    // æ•°å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å¤‰æ›
                    if (header === 'count' || header === 'year' || header === 'week' || 
                        header === 'male_count' || header === 'female_count' || 
                        header === 'total_count' || header === 'sentinel_points') {
                        row[header] = parseInt(value) || 0;
                    } else {
                        row[header] = value;
                    }
                });
                data.push(row);
            }
            
            return data;
        }

        // é™çš„ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–
        async function initializeStaticData() {
            try {
                // å„ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸¦è¡Œã§èª­ã¿è¾¼ã¿
                const [summaryText, diseaseListData, csvText] = await Promise.all([
                    fetchStaticData('summary_statistics.json'),
                    fetchStaticData('disease_list.json'),
                    fetchStaticData('infectious_diseases_data.csv')
                ]);
                
                summaryData = summaryText;
                diseaseList = diseaseListData;
                mainDataset = parseCSV(csvText);
                
                console.log(`ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–å®Œäº†: ${mainDataset.length} ãƒ¬ã‚³ãƒ¼ãƒ‰, ${diseaseList.length} ç–¾ç—…`);
                
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                throw error;
            }
        }

        // Sentinelãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–
        async function initializeSentinelData() {
            try {
                // Sentinelãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸¦è¡Œã§èª­ã¿è¾¼ã¿
                const [sentinelSummaryText, sentinelDiseaseListData, sentinelCsvText] = await Promise.all([
                    fetchStaticData('sentinel_summary_statistics.json'),
                    fetchStaticData('sentinel_disease_list.json'),
                    fetchStaticData('sentinel_diseases_data.csv')
                ]);
                
                sentinelSummaryData = sentinelSummaryText;
                sentinelDiseaseList = sentinelDiseaseListData;
                sentinelDataset = parseCSV(sentinelCsvText);
                
                console.log(`Sentinelãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–å®Œäº†: ${sentinelDataset.length} ãƒ¬ã‚³ãƒ¼ãƒ‰, ${sentinelDiseaseList.length} ç–¾ç—…`);
                
            } catch (error) {
                console.error('Sentinelãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                throw error;
            }
        }

        // é™çš„ãƒ‡ãƒ¼ã‚¿ç”¨ã®APIäº’æ›é–¢æ•°
        async function fetchAPI(endpoint) {
            // ãƒ‡ãƒ¼ã‚¿ãŒæœªåˆæœŸåŒ–ã®å ´åˆã¯åˆæœŸåŒ–
            if (!mainDataset) {
                await initializeStaticData();
            }
            
            try {
                // ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¿œã˜ã¦é™çš„ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ç”Ÿæˆ
                if (endpoint === '/summary') {
                    return summaryData;
                    
                } else if (endpoint === '/diseases') {
                    return { diseases: diseaseList };
                    
                } else if (endpoint.startsWith('/diseases/') && endpoint.includes('/timeseries')) {
                    return generateTimeSeriesData(endpoint);
                    
                } else if (endpoint.startsWith('/diseases/top')) {
                    return generateTopDiseasesData(endpoint);
                    
                } else if (endpoint === '/yearly-trends') {
                    return generateYearlyTrendsData();
                    
                } else {
                    throw new Error(`Unknown endpoint: ${endpoint}`);
                }
            } catch (error) {
                console.error('Static API Error:', error);
                throw error;
            }
        }

        // ç–¾ç—…åˆ¥æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateTimeSeriesData(endpoint) {
            const match = endpoint.match(/\/diseases\/([^\/]+)\/timeseries/);
            if (!match) throw new Error('Invalid timeseries endpoint');
            
            const diseaseNameEncoded = match[1];
            const diseaseName = decodeURIComponent(diseaseNameEncoded);
            
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è§£æ
            const url = new URL(window.location.origin + endpoint);
            const startYear = url.searchParams.get('start_year');
            const endYear = url.searchParams.get('end_year');
            
            // ç–¾ç—…åã¨ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶ã§ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
            let filteredData = mainDataset.filter(record => record.disease_name === diseaseName);
            
            // å¹´ç¯„å›²ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            if (startYear) {
                filteredData = filteredData.filter(record => record.year >= parseInt(startYear));
            }
            if (endYear) {
                filteredData = filteredData.filter(record => record.year <= parseInt(endYear));
            }
            
            // æ—¥ä»˜ã§ã‚½ãƒ¼ãƒˆ
            filteredData.sort((a, b) => a.report_date.localeCompare(b.report_date));
            
            // APIå½¢å¼ã«å¤‰æ›
            const timeseriesData = filteredData.map(record => ({
                date: record.report_date,
                value: record.count
            }));
            
            return {
                disease_name: diseaseName,
                data: timeseriesData,
                total_records: timeseriesData.length
            };
        }

        // ä¸Šä½ç–¾ç—…ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateTopDiseasesData(endpoint) {
            const url = new URL(window.location.origin + endpoint);
            const limit = parseInt(url.searchParams.get('limit')) || 10;
            const year = url.searchParams.get('year');
            
            let data = mainDataset;
            if (year) {
                data = data.filter(record => record.year === parseInt(year));
            }
            
            // ç–¾ç—…åˆ¥åˆè¨ˆã‚’è¨ˆç®—
            const diseaseStats = {};
            data.forEach(record => {
                if (!diseaseStats[record.disease_name]) {
                    diseaseStats[record.disease_name] = {
                        total_count: 0,
                        category: record.category
                    };
                }
                diseaseStats[record.disease_name].total_count += record.count;
            });
            
            // ä¸Šä½ç–¾ç—…ã‚’å–å¾—
            const sortedDiseases = Object.entries(diseaseStats)
                .sort(([,a], [,b]) => b.total_count - a.total_count)
                .slice(0, limit)
                .map(([disease, stats]) => ({
                    disease_name: disease,
                    total_count: stats.total_count,
                    category: stats.category
                }));
            
            return {
                top_diseases: sortedDiseases,
                year: year ? parseInt(year) : null,
                total_diseases: sortedDiseases.length
            };
        }

        // å¹´æ¬¡æ¨ç§»ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateYearlyTrendsData() {
            const yearlyTotals = {};
            
            mainDataset.forEach(record => {
                if (!yearlyTotals[record.year]) {
                    yearlyTotals[record.year] = 0;
                }
                yearlyTotals[record.year] += record.count;
            });
            
            const trends = Object.entries(yearlyTotals)
                .sort(([a], [b]) => parseInt(a) - parseInt(b))
                .map(([year, total]) => ({
                    year: parseInt(year),
                    total_count: total
                }));
            
            return { yearly_trends: trends };
        }

        // æ¦‚æ³ãƒ“ãƒ¥ãƒ¼ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        async function renderOverview() {
            const content = document.getElementById('main-content');
            
            try {
                // ã‚µãƒãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã¨ãƒˆãƒƒãƒ—ç–¾ç—…ã‚’ä¸¦è¡Œå–å¾—
                const [summary, topDiseases, yearlyTrends] = await Promise.all([
                    fetchAPI('/summary'),
                    fetchAPI('/diseases/top?limit=10'),
                    fetchAPI('/yearly-trends')
                ]);

                summaryData = summary;

                content.innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">ç·ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°</div>
                            <div class="stat-value">${summary.total_records.toLocaleString()}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">æ„ŸæŸ“ç—‡ç¨®é¡</div>
                            <div class="stat-value">${summary.total_diseases}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">å¯¾è±¡å¹´æ•°</div>
                            <div class="stat-value">${summary.years_covered.length}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">æ³•å®šåˆ†é¡æ•°</div>
                            <div class="stat-value">${Object.keys(summary.disease_categories).length}</div>
                        </div>
                    </div>
                    
                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-title">å ±å‘Šæ•°ä¸Šä½æ„ŸæŸ“ç—‡</div>
                            <div class="chart-container">
                                <canvas id="topDiseasesChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-title">å¹´æ¬¡æ¨ç§»</div>
                            <div class="chart-container">
                                <canvas id="yearlyTrendsChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-title">æ³•å®šåˆ†é¡åˆ¥åˆ†å¸ƒ</div>
                            <div class="chart-container">
                                <canvas id="categoriesChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-title">ä¸»è¦ç–¾ç—…ä¸€è¦§</div>
                            <div class="disease-list">
                                ${topDiseases.top_diseases.map(disease => `
                                    <div class="disease-item">
                                        <span class="disease-name">${disease.disease_name}</span>
                                        <span class="disease-count">${disease.total_count.toLocaleString()}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;

                // ãƒãƒ£ãƒ¼ãƒˆã®æç”»
                renderTopDiseasesChart(topDiseases.top_diseases);
                renderYearlyTrendsChart(yearlyTrends.yearly_trends);
                renderCategoriesChart(summary.disease_categories);

            } catch (error) {
                content.innerHTML = `<div class="error">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}</div>`;
            }
        }

        // ãƒãƒ£ãƒ¼ãƒˆæç”»é–¢æ•°
        function renderTopDiseasesChart(data) {
            const ctx = document.getElementById('topDiseasesChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.disease_name.length > 10 ? d.disease_name.substring(0, 10) + '...' : d.disease_name),
                    datasets: [{
                        label: 'å ±å‘Šæ•°',
                        data: data.map(d => d.total_count),
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderYearlyTrendsChart(data) {
            const ctx = document.getElementById('yearlyTrendsChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.year.toString()),
                    datasets: [{
                        label: 'å¹´é–“ç·å ±å‘Šæ•°',
                        data: data.map(d => d.total_count),
                        borderColor: 'rgba(34, 197, 94, 1)',
                        backgroundColor: 'rgba(34, 197, 94, 0.2)',
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderCategoriesChart(data) {
            const ctx = document.getElementById('categoriesChart').getContext('2d');
            const colors = [
                'rgba(239, 68, 68, 0.8)',
                'rgba(245, 158, 11, 0.8)',
                'rgba(34, 197, 94, 0.8)',
                'rgba(59, 130, 246, 0.8)',
                'rgba(147, 51, 234, 0.8)',
                'rgba(156, 163, 175, 0.8)'
            ];
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        data: Object.values(data),
                        backgroundColor: colors,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // ç–¾ç—…ã‚’åˆ†é¡åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
        function groupDiseasesByCategory(diseases, summaryData) {
            // åˆ†é¡åˆ¥ç–¾ç—…ãƒãƒƒãƒ—ã‚’ä½œæˆ
            const categoryMap = {
                "1é¡æ„ŸæŸ“ç—‡": [
                    "ã‚¨ãƒœãƒ©å‡ºè¡€ç†±", "ã‚¯ãƒªãƒŸã‚¢ãƒ»ã‚³ãƒ³ã‚´å‡ºè¡€ç†±", "ç—˜ãã†", "å—ç±³å‡ºè¡€ç†±", 
                    "ãƒšã‚¹ãƒˆ", "ãƒãƒ¼ãƒ«ãƒ–ãƒ«ã‚°ç—…", "ãƒ©ãƒƒã‚µç†±"
                ],
                "2é¡æ„ŸæŸ“ç—‡": [
                    "æ€¥æ€§ç°ç™½é«„ç‚", "çµæ ¸", "ã‚¸ãƒ•ãƒ†ãƒªã‚¢", "é‡ç—‡æ€¥æ€§å‘¼å¸å™¨ç—‡å€™ç¾¤", 
                    "ä¸­æ±å‘¼å¸å™¨ç—‡å€™ç¾¤", "é³¥ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶ï¼ˆH5N1)", "é³¥ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶ï¼ˆH7N9)",
                    "é³¥ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶ï¼ˆH5N1ãŠã‚ˆã³H7N9ã‚’é™¤ãï¼‰"
                ],
                "3é¡æ„ŸæŸ“ç—‡": [
                    "ã‚³ãƒ¬ãƒ©", "ç´°èŒæ€§èµ¤ç—¢", "è…¸ãƒãƒ•ã‚¹", "ãƒ‘ãƒ©ãƒãƒ•ã‚¹"
                ],
                "4é¡æ„ŸæŸ“ç—‡": [
                    "Aå‹è‚ç‚", "Eå‹è‚ç‚", "ã¤ã¤ãŒè™«ç—…", "ã‚¦ã‚¤ãƒ«ã‚¹æ€§è‚ç‚ï¼ˆï¼¥å‹è‚ç‚åŠã³ï¼¡å‹è‚ç‚ã‚’é™¤ãã€‚ï¼‰",
                    "ã‚¦ã‚¨ã‚¹ãƒˆãƒŠã‚¤ãƒ«ç†±", "ã‚¨ã‚­ãƒã‚³ãƒƒã‚¯ã‚¹ç—‡", "ã‚ªã‚¦ãƒ ç—…", "ã‚ªãƒ ã‚¹ã‚¯å‡ºè¡€ç†±",
                    "å›å¸°ç†±", "ï¼±ç†±", "ç‹‚çŠ¬ç—…", "ã‚³ã‚¯ã‚·ã‚¸ã‚ªã‚¤ãƒ‡ã‚¹ç—‡", "ã‚¸ã‚«ã‚¦ã‚¤ãƒ«ã‚¹æ„ŸæŸ“ç—‡",
                    "é‡ç—‡ç†±æ€§è¡€å°æ¿æ¸›å°‘ç—‡å€™ç¾¤", "è…ç—‡å€™æ€§å‡ºè¡€ç†±", "è¥¿éƒ¨ã‚¦ãƒè„³ç‚", "ãƒ€ãƒ‹åª’ä»‹è„³ç‚",
                    "ç‚­ç–½", "ãƒã‚¯ãƒ³ã‚°ãƒ‹ã‚¢ç†±", "ãƒ‡ãƒ³ã‚°ç†±", "æ±éƒ¨ã‚¦ãƒè„³ç‚",
                    "ãƒ‹ãƒ‘ã‚¦ã‚¤ãƒ«ã‚¹æ„ŸæŸ“ç—‡", "æ—¥æœ¬ç´…æ–‘ç†±", "æ—¥æœ¬è„³ç‚", "ãƒãƒ³ã‚¿ã‚¦ã‚¤ãƒ«ã‚¹è‚ºç—‡å€™ç¾¤", 
                    "ï¼¢ã‚¦ã‚¤ãƒ«ã‚¹ç—…", "é¼»ç–½", "ãƒ–ãƒ«ã‚»ãƒ©ç—‡", "ãƒ™ãƒã‚ºã‚¨ãƒ©ã‚¦ãƒè„³ç‚", "ãƒ˜ãƒ³ãƒ‰ãƒ©ã‚¦ã‚¤ãƒ«ã‚¹æ„ŸæŸ“ç—‡", 
                    "ç™ºã—ã‚“ãƒãƒ•ã‚¹", "ãƒœãƒ„ãƒªãƒŒã‚¹ç—‡", "ãƒãƒ©ãƒªã‚¢", "é‡å…ç—…", "ãƒ©ã‚¤ãƒ ç—…", 
                    "ãƒªãƒƒã‚µã‚¦ã‚¤ãƒ«ã‚¹æ„ŸæŸ“ç—‡", "ãƒªãƒ•ãƒˆãƒãƒ¬ãƒ¼ç†±", "é¡é¼»ç–½", "ãƒ¬ã‚¸ã‚ªãƒãƒ©ç—‡", 
                    "ãƒ¬ãƒ—ãƒˆã‚¹ãƒ”ãƒ©ç—‡", "ãƒ­ãƒƒã‚­ãƒ¼å±±ç´…æ–‘ç†±", "é»„ç†±"
                ],
                "5é¡æ„ŸæŸ“ç—‡": [
                    "ã‚¢ãƒ¡ãƒ¼ãƒèµ¤ç—¢", "ã‚«ãƒ«ãƒãƒšãƒãƒ è€æ€§è…¸å†…ç´°èŒç›®ç´°èŒæ„ŸæŸ“ç—‡", 
                    "æ€¥æ€§å¼›ç·©æ€§éº»ç—ºï¼ˆæ€¥æ€§ç°ç™½é«„ç‚ã‚’é™¤ãã€‚ï¼‰", "æ€¥æ€§è„³ç‚", "ã‚¯ãƒªãƒ—ãƒˆã‚¹ãƒãƒªã‚¸ã‚¦ãƒ ç—‡", 
                    "ã‚¯ãƒ­ã‚¤ãƒ„ãƒ•ã‚§ãƒ«ãƒˆãƒ»ãƒ¤ã‚³ãƒ–ç—…", "åŠ‡ç—‡å‹æº¶è¡€æ€§ãƒ¬ãƒ³ã‚µçƒèŒæ„ŸæŸ“ç—‡", "å¾Œå¤©æ€§å…ç–«ä¸å…¨ç—‡å€™ç¾¤", 
                    "ã‚¸ã‚¢ãƒ«ã‚¸ã‚¢ç—‡", "ä¾µè¥²æ€§ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶èŒæ„ŸæŸ“ç—‡", "ä¾µè¥²æ€§è‚ºç‚çƒèŒæ„ŸæŸ“ç—‡", 
                    "ä¾µè¥²æ€§é«„è†œç‚èŒæ„ŸæŸ“ç—‡", "æ°´ç—˜ï¼ˆå…¥é™¢ä¾‹ã«é™ã‚‹ï¼‰", "å…ˆå¤©æ€§é¢¨ã—ã‚“ç—‡å€™ç¾¤", "æ¢…æ¯’", 
                    "æ’­ç¨®æ€§ã‚¯ãƒªãƒ—ãƒˆã‚³ãƒƒã‚¯ã‚¹ç—‡", "ãƒãƒ³ã‚³ãƒã‚¤ã‚·ãƒ³è€æ€§è…¸çƒèŒæ„ŸæŸ“ç—‡", 
                    "ãƒãƒ³ã‚³ãƒã‚¤ã‚·ãƒ³è€æ€§é»„è‰²ãƒ–ãƒ‰ã‚¦çƒèŒæ„ŸæŸ“ç—‡", "ç™¾æ—¥å’³", "é¢¨ã—ã‚“", "éº»ã—ã‚“", 
                    "è–¬å‰¤è€æ€§ã‚¢ã‚·ãƒãƒˆãƒã‚¯ã‚¿ãƒ¼æ„ŸæŸ“ç—‡", "è…¸ç®¡å‡ºè¡€æ€§å¤§è…¸èŒæ„ŸæŸ“ç—‡", "é«„è†œç‚èŒæ€§é«„è†œç‚"
                ]
            };

            // ç–¾ç—…ã‚’åˆ†é¡åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const groupedDiseases = {};
            const uncategorized = [];

            // åˆ†é¡åˆ¥ã«ç–¾ç—…ã‚’æŒ¯ã‚Šåˆ†ã‘
            Object.keys(categoryMap).forEach(category => {
                groupedDiseases[category] = [];
                categoryMap[category].forEach(disease => {
                    if (diseases.includes(disease)) {
                        groupedDiseases[category].push(disease);
                    }
                });
                // ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«ã‚½ãƒ¼ãƒˆ
                groupedDiseases[category].sort();
            });

            // åˆ†é¡ã«è©²å½“ã—ãªã„ç–¾ç—…ã‚’ç‰¹å®š
            diseases.forEach(disease => {
                let found = false;
                Object.values(categoryMap).forEach(categoryDiseases => {
                    if (categoryDiseases.includes(disease)) {
                        found = true;
                    }
                });
                if (!found) {
                    uncategorized.push(disease);
                }
            });

            if (uncategorized.length > 0) {
                groupedDiseases["ãã®ä»–"] = uncategorized.sort();
            }

            return groupedDiseases;
        }

        // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ
        function generateDiseaseOptions(groupedDiseases, summaryData) {
            let options = '<option value="">æ„ŸæŸ“ç—‡ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
            
            Object.entries(groupedDiseases).forEach(([category, diseases]) => {
                if (diseases.length > 0) {
                    // åˆ†é¡ã®å ±å‘Šæ•°ã‚’å–å¾—
                    const categoryCount = summaryData?.disease_categories?.[category] || 0;
                    options += `<optgroup label="${category} (${categoryCount.toLocaleString()}ä»¶)">`;
                    
                    diseases.forEach(disease => {
                        // å€‹åˆ¥ç–¾ç—…ã®å ±å‘Šæ•°ã‚’å–å¾—
                        const diseaseCount = summaryData?.top_diseases?.[disease] || 0;
                        const countDisplay = diseaseCount > 0 ? ` (${diseaseCount.toLocaleString()}ä»¶)` : '';
                        options += `<option value="${disease}">${disease}${countDisplay}</option>`;
                    });
                    
                    options += '</optgroup>';
                }
            });
            
            return options;
        }

        // ç–¾ç—…åˆ¥åˆ†æãƒ“ãƒ¥ãƒ¼ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        async function renderDiseaseAnalysis() {
            const content = document.getElementById('main-content');
            
            try {
                // ç–¾ç—…ãƒªã‚¹ãƒˆã¨ã‚µãƒãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                if (diseaseList.length === 0) {
                    const diseaseData = await fetchAPI('/diseases');
                    diseaseList = diseaseData.diseases;
                }

                // ç–¾ç—…ã‚’åˆ†é¡åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
                const groupedDiseases = groupDiseasesByCategory(diseaseList, summaryData);
                const diseaseOptions = generateDiseaseOptions(groupedDiseases, summaryData);

                content.innerHTML = `
                    <div class="filter-section">
                        <h3 class="chart-title">åˆ†æå¯¾è±¡è¨­å®š</h3>
                        <div class="filter-grid">
                            <div class="form-group">
                                <label class="form-label">æ„ŸæŸ“ç—‡åï¼ˆæ³•å®šåˆ†é¡åˆ¥ï¼‰</label>
                                <select id="diseaseSelect" class="form-select">
                                    ${diseaseOptions}
                                </select>
                                <div style="font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem;">
                                    â€»æ‹¬å¼§å†…ã¯å…¨æœŸé–“ã®å ±å‘Šæ•°
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">é–‹å§‹å¹´</label>
                                <select id="startYear" class="form-select">
                                    ${Array.from({length: 26}, (_, i) => 2000 + i).map(year => `
                                        <option value="${year}" ${year === 2020 ? 'selected' : ''}>${year}å¹´</option>
                                    `).join('')}
                                </select>
                                <div style="font-size: 0.75rem; color: transparent; margin-top: 0.25rem;">
                                    ã€€
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">çµ‚äº†å¹´</label>
                                <select id="endYear" class="form-select">
                                    ${Array.from({length: 26}, (_, i) => 2000 + i).map(year => `
                                        <option value="${year}" ${year === 2024 ? 'selected' : ''}>${year}å¹´</option>
                                    `).join('')}
                                </select>
                                <div style="font-size: 0.75rem; color: transparent; margin-top: 0.25rem;">
                                    ã€€
                                </div>
                            </div>
                            <div class="form-group">
                                <button id="analyzeBtn" class="btn btn-primary" disabled>åˆ†æå®Ÿè¡Œ</button>
                                <div style="font-size: 0.75rem; color: transparent; margin-top: 0.25rem;">
                                    ã€€
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="analysisResults" style="display: none;">
                        <div class="metric-cards">
                            <div class="metric-card">
                                <div class="metric-value" id="totalRecords">-</div>
                                <div class="metric-label">ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆæ•°</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="totalCases">-</div>
                                <div class="metric-label">æœŸé–“å†…ç·å ±å‘Šæ•°</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="maxWeekly">-</div>
                                <div class="metric-label">æœ€å¤§é€±é–“å ±å‘Šæ•°</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="avgWeekly">-</div>
                                <div class="metric-label">é€±å¹³å‡å ±å‘Šæ•°</div>
                            </div>
                        </div>
                        
                        <div class="charts-grid">
                            <div class="chart-card" style="grid-column: 1 / -1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <div class="chart-title" id="timeseriesTitle">æ™‚ç³»åˆ—ã‚°ãƒ©ãƒ•</div>
                                    <div style="display: flex; gap: 1rem; align-items: center;">
                                        <div class="form-group" style="margin: 0;">
                                            <button id="seasonalToggleBtn" class="btn btn-primary" style="font-size: 0.875rem; padding: 0.375rem 0.75rem;">
                                                å­£ç¯€æ€§æ¯”è¼ƒ
                                            </button>
                                        </div>
                                        <div class="form-group" style="margin: 0;">
                                            <select id="timeUnitSelect" class="form-select" style="min-width: 120px;">
                                                <option value="week">é€±å˜ä½</option>
                                                <option value="month">æœˆå˜ä½</option>
                                                <option value="year">å¹´å˜ä½</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="chart-container" style="height: 400px;">
                                    <canvas id="timeseriesChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-title">ãƒ‡ãƒ¼ã‚¿è©³ç´° (æœ€æ–°20ä»¶)</div>
                            <div style="max-height: 400px; overflow-y: auto;">
                                <table class="data-table" id="dataTable">
                                    <thead>
                                        <tr>
                                            <th>å ±å‘Šæ—¥</th>
                                            <th>å ±å‘Šæ•°</th>
                                            <th>å¹´</th>
                                            <th>é€±</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dataTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;

                // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                setupDiseaseAnalysisEvents();

            } catch (error) {
                content.innerHTML = `<div class="error">ç–¾ç—…åˆ¥åˆ†æã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}</div>`;
            }
        }

        // ç–¾ç—…åˆ¥åˆ†æã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
        function setupDiseaseAnalysisEvents() {
            const diseaseSelect = document.getElementById('diseaseSelect');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const timeUnitSelect = document.getElementById('timeUnitSelect');
            const seasonalToggleBtn = document.getElementById('seasonalToggleBtn');

            diseaseSelect.addEventListener('change', function() {
                analyzeBtn.disabled = !this.value;
                // ç–¾ç—…ãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰å­£ç¯€æ€§ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ
                isSeasonalMode = false;
                seasonalData = null;
                updateSeasonalToggleButton();
            });

            // æ™‚é–“å˜ä½å¤‰æ›´æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            timeUnitSelect.addEventListener('change', function() {
                if (currentDiseaseData && !isSeasonalMode) {
                    const disease = diseaseSelect.value;
                    renderDiseaseTimeseries(currentDiseaseData, disease);
                }
            });

            // å­£ç¯€æ€§æ¯”è¼ƒãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            seasonalToggleBtn.addEventListener('click', function() {
                toggleSeasonalMode();
            });

            analyzeBtn.addEventListener('click', async function() {
                const disease = diseaseSelect.value;
                const startYear = document.getElementById('startYear').value;
                const endYear = document.getElementById('endYear').value;

                if (!disease) return;

                this.disabled = true;
                this.textContent = 'åˆ†æä¸­...';

                try {
                    await analyzeDiseaseData(disease, startYear, endYear);
                } catch (error) {
                    alert('åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
                } finally {
                    this.disabled = false;
                    this.textContent = 'åˆ†æå®Ÿè¡Œ';
                }
            });
        }

        // ç–¾ç—…ãƒ‡ãƒ¼ã‚¿ã®åˆ†æå®Ÿè¡Œ
        async function analyzeDiseaseData(disease, startYear, endYear) {
            try {
                // é–‹å§‹å¹´ã¨çµ‚äº†å¹´ãŒåŒã˜å ´åˆã¯å­£ç¯€æ€§æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰
                const isSameYear = parseInt(startYear) === parseInt(endYear);
                
                if (isSameYear) {
                    await analyzeSeasonalPattern(disease, startYear);
                } else {
                    const data = await fetchAPI(`/diseases/${encodeURIComponent(disease)}/timeseries?start_year=${startYear}&end_year=${endYear}`);
                    currentDiseaseData = data;

                    // çµ±è¨ˆæƒ…å ±ã‚’è¨ˆç®—
                    const totalCases = data.data.reduce((sum, item) => sum + item.value, 0);
                    const maxWeekly = Math.max(...data.data.map(item => item.value));
                    const avgWeekly = totalCases / data.data.length;

                    // ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°
                    document.getElementById('totalRecords').textContent = data.total_records.toLocaleString();
                    document.getElementById('totalCases').textContent = totalCases.toLocaleString();
                    document.getElementById('maxWeekly').textContent = maxWeekly.toLocaleString();
                    document.getElementById('avgWeekly').textContent = avgWeekly.toFixed(1);

                    // ãƒãƒ£ãƒ¼ãƒˆã‚’æç”»
                    renderDiseaseTimeseries(data, disease);

                    // ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°
                    updateDataTable(data.data);
                }

                // çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
                document.getElementById('analysisResults').style.display = 'block';

            } catch (error) {
                throw new Error(`ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
            }
        }

        // å­£ç¯€æ€§ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
        async function analyzeSeasonalPattern(disease, targetYear) {
            try {
                // å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦è¤‡æ•°å¹´ã®ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
                const allData = await fetchAPI(`/diseases/${encodeURIComponent(disease)}/timeseries?start_year=2000&end_year=2025`);
                
                // å¯¾è±¡å¹´ã‚’å«ã‚€éå»5å¹´åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const years = [];
                const currentYear = parseInt(targetYear);
                for (let i = 4; i >= 0; i--) {
                    const year = currentYear - i;
                    if (year >= 2000) {
                        years.push(year);
                    }
                }
                
                // å¹´åˆ¥ã«ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†é›¢
                const yearlyData = {};
                years.forEach(year => {
                    yearlyData[year] = allData.data.filter(item => {
                        const itemYear = new Date(item.date).getFullYear();
                        return itemYear === year;
                    });
                });
                
                // é€±ç•ªå·ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ­£è¦åŒ–ï¼ˆ52é€±ã¨ã—ã¦æ‰±ã†ï¼‰
                const normalizedData = {};
                years.forEach(year => {
                    normalizedData[year] = [];
                    for (let week = 1; week <= 52; week++) {
                        const weekData = yearlyData[year].filter(item => {
                            const date = new Date(item.date);
                            const weekNum = getWeekNumber(date);
                            return weekNum === week;
                        });
                        
                        const totalValue = weekData.reduce((sum, item) => sum + item.value, 0);
                        normalizedData[year].push({
                            week: week,
                            value: totalValue,
                            date: `${year}-W${String(week).padStart(2, '0')}`
                        });
                    }
                });
                
                // çµ±è¨ˆæƒ…å ±ã‚’è¨ˆç®—ï¼ˆå¯¾è±¡å¹´ã®ãƒ‡ãƒ¼ã‚¿ï¼‰
                const targetYearData = normalizedData[currentYear] || [];
                const totalCases = targetYearData.reduce((sum, item) => sum + item.value, 0);
                const maxWeekly = Math.max(...targetYearData.map(item => item.value));
                const avgWeekly = totalCases / 52;
                
                // ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°
                document.getElementById('totalRecords').textContent = targetYearData.length.toLocaleString();
                document.getElementById('totalCases').textContent = totalCases.toLocaleString();
                document.getElementById('maxWeekly').textContent = maxWeekly.toLocaleString();
                document.getElementById('avgWeekly').textContent = avgWeekly.toFixed(1);
                
                // å­£ç¯€æ€§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                seasonalData = {
                    normalizedData: normalizedData,
                    disease: disease,
                    years: years,
                    targetYear: currentYear,
                    yearlyData: yearlyData
                };
                
                // å­£ç¯€æ€§ãƒ¢ãƒ¼ãƒ‰ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
                isSeasonalMode = true;
                updateSeasonalToggleButton();
                
                // å­£ç¯€æ€§æ¯”è¼ƒãƒãƒ£ãƒ¼ãƒˆã‚’æç”»
                renderSeasonalComparisonChart(normalizedData, disease, years, currentYear);
                
                // ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°ï¼ˆå¯¾è±¡å¹´ã®ãƒ‡ãƒ¼ã‚¿ï¼‰
                updateDataTable(yearlyData[currentYear] || []);
                
                // currentDiseaseDataã‚’è¨­å®šï¼ˆæ™‚é–“å˜ä½å¤‰æ›´ã«å¯¾å¿œï¼‰
                currentDiseaseData = {
                    disease_name: disease,
                    data: yearlyData[currentYear] || [],
                    total_records: targetYearData.length
                };
                
            } catch (error) {
                throw new Error(`å­£ç¯€æ€§ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
            }
        }
        
        // é€±ç•ªå·ã‚’å–å¾—ã™ã‚‹é–¢æ•°
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }
        
        // å­£ç¯€æ€§æ¯”è¼ƒãƒãƒ£ãƒ¼ãƒˆã®æç”»
        function renderSeasonalComparisonChart(normalizedData, diseaseName, years, targetYear) {
            const ctx = document.getElementById('timeseriesChart');
            
            // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆã‚’ç ´æ£„
            if (window.diseaseChart) {
                window.diseaseChart.destroy();
            }
            
            // ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
            document.getElementById('timeseriesTitle').textContent = `${diseaseName} ã®å­£ç¯€æ€§ãƒ‘ã‚¿ãƒ¼ãƒ³æ¯”è¼ƒï¼ˆ${targetYear}å¹´ã¨éå»4å¹´ï¼‰`;
            
            // å¹´æ¯ã®è‰²åˆ†ã‘é…åˆ—ï¼ˆéå»å¹´ç”¨ï¼‰
            const pastYearColors = [
                'rgba(59, 130, 246, 0.8)',  // é’
                'rgba(34, 197, 94, 0.8)',   // ç·‘
                'rgba(245, 158, 11, 0.8)',  // ã‚ªãƒ¬ãƒ³ã‚¸
                'rgba(147, 51, 234, 0.8)',  // ç´«
                'rgba(236, 72, 153, 0.8)'   // ãƒ”ãƒ³ã‚¯
            ];
            
            // å¯¾è±¡å¹´ç”¨ã®è‰²ï¼ˆç‹¬ç«‹ï¼‰
            const targetYearColor = 'rgba(239, 68, 68, 1)';  // èµ¤
            const targetYearBg = 'rgba(239, 68, 68, 0.1)';
            
            // ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½œæˆï¼ˆå¯¾è±¡å¹´ã‚’æœ€åˆã«ã€ãã®å¾Œæ–°ã—ã„å¹´ã‹ã‚‰å¤ã„å¹´ã®é †ï¼‰
            const datasets = [];
            
            // å¯¾è±¡å¹´ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æœ€åˆã«è¿½åŠ 
            datasets.push({
                label: `${targetYear}å¹´ (å¯¾è±¡å¹´)`,
                data: normalizedData[targetYear] ? normalizedData[targetYear].map(item => item.value) : new Array(52).fill(0),
                borderColor: targetYearColor,
                backgroundColor: targetYearBg,
                tension: 0.1,
                fill: true,
                pointRadius: 4,
                pointHoverRadius: 7,
                borderWidth: 4,
                order: 0  // æœ€å‰é¢ã«è¡¨ç¤º
            });
            
            // éå»å¹´ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æ–°ã—ã„å¹´ã‹ã‚‰å¤ã„å¹´ã®é †ã§è¿½åŠ 
            const pastYears = years.filter(year => year !== targetYear).sort((a, b) => b - a); // é™é †ã‚½ãƒ¼ãƒˆ
            pastYears.forEach((year, index) => {
                datasets.push({
                    label: `${year}å¹´`,
                    data: normalizedData[year] ? normalizedData[year].map(item => item.value) : new Array(52).fill(0),
                    borderColor: pastYearColors[index % pastYearColors.length],
                    backgroundColor: 'transparent',
                    tension: 0.1,
                    fill: false,
                    pointRadius: 3,
                    pointHoverRadius: 5,
                    borderWidth: 3,
                    order: index + 1
                });
            });
            
            // é€±ãƒ©ãƒ™ãƒ«ã‚’ä½œæˆ
            const weekLabels = [];
            for (let week = 1; week <= 52; week++) {
                if (week % 4 === 1 || week === 1) {
                    weekLabels.push(`ç¬¬${week}é€±`);
                } else {
                    weekLabels.push('');
                }
            }
            
            window.diseaseChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weekLabels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                filter: function(legendItem, chartData) {
                                    // å¯¾è±¡å¹´ã‚’æœ€åˆã«è¡¨ç¤º
                                    return true;
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    const weekNum = context[0].dataIndex + 1;
                                    return `ç¬¬${weekNum}é€±`;
                                },
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y}ä»¶`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'é€±é–“å ±å‘Šæ•°'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'é€±ç•ªå·ï¼ˆå¹´é–“ï¼‰'
                            },
                            ticks: {
                                maxTicksLimit: 13  // ç´„4é€±é–“ã”ã¨ã«è¡¨ç¤º
                            }
                        }
                    }
                }
            });
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚’æŒ‡å®šã—ãŸæ™‚é–“å˜ä½ã§é›†ç´„
        function aggregateDataByTimeUnit(data, timeUnit) {
            const aggregated = {};
            
            data.forEach(item => {
                const date = new Date(item.date);
                let key;
                
                switch (timeUnit) {
                    case 'week':
                        // é€±å˜ä½: ãã®ã¾ã¾ä½¿ç”¨
                        key = item.date.substring(0, 10); // YYYY-MM-DD
                        break;
                    case 'month':
                        // æœˆå˜ä½: YYYY-MMå½¢å¼
                        key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                        break;
                    case 'year':
                        // å¹´å˜ä½: YYYYå½¢å¼
                        key = date.getFullYear().toString();
                        break;
                    default:
                        key = item.date.substring(0, 10);
                }
                
                if (!aggregated[key]) {
                    aggregated[key] = {
                        date: key,
                        value: 0
                    };
                }
                aggregated[key].value += item.value;
            });
            
            // æ—¥ä»˜ã§ã‚½ãƒ¼ãƒˆ
            return Object.values(aggregated).sort((a, b) => a.date.localeCompare(b.date));
        }

        // ãƒ©ãƒ™ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatLabel(dateString, timeUnit) {
            switch (timeUnit) {
                case 'week':
                    const date = new Date(dateString);
                    return date.toLocaleDateString('ja-JP', { year: 'numeric', month: 'short', day: 'numeric' });
                case 'month':
                    const [year, month] = dateString.split('-');
                    return `${year}å¹´${parseInt(month)}æœˆ`;
                case 'year':
                    return `${dateString}å¹´`;
                default:
                    return dateString;
            }
        }

        // ç–¾ç—…æ™‚ç³»åˆ—ãƒãƒ£ãƒ¼ãƒˆã®æç”»
        function renderDiseaseTimeseries(data, diseaseName) {
            const ctx = document.getElementById('timeseriesChart');
            const timeUnit = document.getElementById('timeUnitSelect').value;
            
            // å­£ç¯€æ€§ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ
            isSeasonalMode = false;
            updateSeasonalToggleButton();
            
            // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆã‚’ç ´æ£„
            if (window.diseaseChart) {
                window.diseaseChart.destroy();
            }

            // ãƒ‡ãƒ¼ã‚¿ã‚’æ™‚é–“å˜ä½ã§é›†ç´„
            const aggregatedData = aggregateDataByTimeUnit(data.data, timeUnit);

            // ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
            const unitText = {
                'week': 'é€±å˜ä½',
                'month': 'æœˆå˜ä½', 
                'year': 'å¹´å˜ä½'
            };
            document.getElementById('timeseriesTitle').textContent = `${diseaseName} ã®ç™ºç”Ÿå‹•å‘ï¼ˆ${unitText[timeUnit]}ï¼‰`;

            // Xè»¸ã®ãƒ©ãƒ™ãƒ«æ•°ã‚’èª¿æ•´
            const maxLabels = timeUnit === 'week' ? 20 : timeUnit === 'month' ? 24 : 10;
            const stepSize = Math.max(1, Math.ceil(aggregatedData.length / maxLabels));

            window.diseaseChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: aggregatedData.map(item => formatLabel(item.date, timeUnit)),
                    datasets: [{
                        label: diseaseName,
                        data: aggregatedData.map(item => item.value),
                        borderColor: 'rgba(59, 130, 246, 1)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.1,
                        fill: true,
                        pointRadius: timeUnit === 'year' ? 4 : timeUnit === 'month' ? 3 : 2,
                        pointHoverRadius: timeUnit === 'year' ? 6 : 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'å ±å‘Šæ•°'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'å ±å‘Šæ—¥'
                            },
                            ticks: {
                                maxTicksLimit: maxLabels,
                                callback: function(value, index) {
                                    // ãƒ©ãƒ™ãƒ«ã‚’é–“å¼•ã„ã¦è¡¨ç¤º
                                    return index % stepSize === 0 ? this.getLabelForValue(value) : '';
                                }
                            }
                        }
                    }
                }
            });
        }

        // å­£ç¯€æ€§åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
        function updateSeasonalToggleButton() {
            const btn = document.getElementById('seasonalToggleBtn');
            if (btn) {
                if (isSeasonalMode) {
                    btn.textContent = 'é€šå¸¸è¡¨ç¤º';
                    btn.style.backgroundColor = '#dc2626';
                    btn.style.borderColor = '#dc2626';
                } else {
                    btn.textContent = 'å­£ç¯€æ€§æ¯”è¼ƒ';
                    btn.style.backgroundColor = '#3b82f6';
                    btn.style.borderColor = '#3b82f6';
                }
            }
        }

        // å­£ç¯€æ€§ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆ
        function toggleSeasonalMode() {
            if (!currentDiseaseData) return;
            
            const diseaseSelect = document.getElementById('diseaseSelect');
            const startYear = document.getElementById('startYear').value;
            const endYear = document.getElementById('endYear').value;
            const disease = diseaseSelect.value;
            
            if (isSeasonalMode) {
                // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã™
                isSeasonalMode = false;
                updateSeasonalToggleButton();
                renderDiseaseTimeseries(currentDiseaseData, disease);
            } else {
                // å­£ç¯€æ€§ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ
                if (seasonalData && seasonalData.disease === disease) {
                    // æ—¢å­˜ã®å­£ç¯€æ€§ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
                    isSeasonalMode = true;
                    updateSeasonalToggleButton();
                    renderSeasonalComparisonChart(
                        seasonalData.normalizedData, 
                        seasonalData.disease, 
                        seasonalData.years, 
                        seasonalData.targetYear
                    );
                } else {
                    // æ–°ã—ã„å­£ç¯€æ€§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                    const targetYear = parseInt(startYear) === parseInt(endYear) ? startYear : endYear;
                    analyzeSeasonalPattern(disease, targetYear);
                }
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ›´æ–°
        function updateDataTable(data) {
            const tbody = document.getElementById('dataTableBody');
            const recentData = data.slice(-20).reverse(); // æœ€æ–°20ä»¶ã‚’é€†é †ã§è¡¨ç¤º

            tbody.innerHTML = recentData.map(item => {
                const date = new Date(item.date);
                const year = date.getFullYear();
                const week = Math.ceil((date - new Date(year, 0, 1)) / (7 * 24 * 60 * 60 * 1000));
                
                return `
                    <tr>
                        <td>${date.toLocaleDateString('ja-JP')}</td>
                        <td style="font-family: monospace; text-align: right;">${item.value}</td>
                        <td>${year}</td>
                        <td>${week}</td>
                    </tr>
                `;
            }).join('');
        }

        // ãƒ“ãƒ¥ãƒ¼ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        async function renderView(view) {
            const content = document.getElementById('main-content');
            
            switch (view) {
                case 'overview':
                    await renderOverview();
                    break;
                case 'diseases':
                    await renderDiseaseAnalysis();
                    break;
                case 'categories':
                    content.innerHTML = '<div class="loading">åˆ†é¡åˆ¥çµ±è¨ˆæ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™...</div>';
                    break;
                case 'trends':
                    content.innerHTML = '<div class="loading">æ™‚ç³»åˆ—åˆ†ææ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™...</div>';
                    break;
                case 'sentinel-overview':
                    await renderSentinelOverview();
                    break;
                case 'sentinel-diseases':
                    await renderSentinelDiseases();
                    break;
                case 'sentinel-geographic':
                    await renderSentinelGeographic();
                    break;
                default:
                    content.innerHTML = '<div class="error">ä¸æ˜ãªãƒ“ãƒ¥ãƒ¼ã§ã™</div>';
            }
        }

        // å®šç‚¹ã‚µãƒ¼ãƒ™ã‚¤ãƒ©ãƒ³ã‚¹æ¦‚æ³ãƒ“ãƒ¥ãƒ¼
        async function renderSentinelOverview() {
            const content = document.getElementById('main-content');
            
            content.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card" style="background: linear-gradient(135deg, #059669, #047857);">
                        <div class="stat-label">å®šç‚¹åŒ»ç™‚æ©Ÿé–¢æ•°</div>
                        <div class="stat-value">ç´„400</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #dc2626, #b91c1c);">
                        <div class="stat-label">ç›£è¦–å¯¾è±¡ç–¾æ‚£</div>
                        <div class="stat-value">28ç¨®é¡</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #7c3aed, #6d28d9);">
                        <div class="stat-label">ãƒ‡ãƒ¼ã‚¿æœŸé–“</div>
                        <div class="stat-value">26å¹´é–“</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #ea580c, #c2410c);">
                        <div class="stat-label">é€±æ¬¡å ±å‘Š</div>
                        <div class="stat-value">1,352é€±</div>
                    </div>
                </div>
                
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-title">ğŸ¤§ ä¸»è¦ç›£è¦–ç–¾æ‚£ã®ç‰¹å¾´</div>
                        <div style="padding: 1rem;">
                            <div style="display: grid; gap: 1rem;">
                                <div style="padding: 1rem; background: #fef3c7; border-radius: 0.5rem; border-left: 4px solid #f59e0b;">
                                    <div style="font-weight: 600; color: #92400e;">ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶</div>
                                    <div style="font-size: 0.875rem; color: #78350f; margin-top: 0.25rem;">å†¬å­£ã«æµè¡Œã™ã‚‹å­£ç¯€æ€§æ„ŸæŸ“ç—‡ã€‚å®šç‚¹ã‚µãƒ¼ãƒ™ã‚¤ãƒ©ãƒ³ã‚¹ã®ä¸»è¦ç›£è¦–å¯¾è±¡</div>
                                </div>
                                <div style="padding: 1rem; background: #dbeafe; border-radius: 0.5rem; border-left: 4px solid #3b82f6;">
                                    <div style="font-weight: 600; color: #1d4ed8;">æ„ŸæŸ“æ€§èƒƒè…¸ç‚</div>
                                    <div style="font-size: 0.875rem; color: #1e40af; margin-top: 0.25rem;">å¹´é–“ã‚’é€šã˜ã¦ç™ºç”Ÿã€‚ç‰¹ã«å†¬å­£ã«ãƒãƒ­ã‚¦ã‚¤ãƒ«ã‚¹ã«ã‚ˆã‚‹æµè¡Œ</div>
                                </div>
                                <div style="padding: 1rem; background: #dcfce7; border-radius: 0.5rem; border-left: 4px solid #22c55e;">
                                    <div style="font-weight: 600; color: #15803d;">RSã‚¦ã‚¤ãƒ«ã‚¹æ„ŸæŸ“ç—‡</div>
                                    <div style="font-size: 0.875rem; color: #166534; margin-top: 0.25rem;">ä¹³å¹¼å…ã®é‡è¦ãªå‘¼å¸å™¨æ„ŸæŸ“ç—‡ã€‚ç§‹å†¬å­£ã«æµè¡Œ</div>
                                </div>
                                <div style="padding: 1rem; background: #fce7f3; border-radius: 0.5rem; border-left: 4px solid #ec4899;">
                                    <div style="font-weight: 600; color: #be185d;">æ‰‹è¶³å£ç—…</div>
                                    <div style="font-size: 0.875rem; color: #9d174d; margin-top: 0.25rem;">å¤å­£ã«æµè¡Œã™ã‚‹å°å…ã®æ„ŸæŸ“ç—‡ã€‚ã‚¨ãƒ³ãƒ†ãƒ­ã‚¦ã‚¤ãƒ«ã‚¹ãŒåŸå› </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-title">ğŸ“Š å®šç‚¹ã‚µãƒ¼ãƒ™ã‚¤ãƒ©ãƒ³ã‚¹ã‚·ã‚¹ãƒ†ãƒ </div>
                        <div style="padding: 1rem;">
                            <div style="display: grid; gap: 1rem;">
                                <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: #f9fafb; border-radius: 0.375rem;">
                                    <span style="font-weight: 500;">ãƒ‡ãƒ¼ã‚¿å½¢å¼</span>
                                    <span>é€±æ¬¡å ±å‘Š</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: #f9fafb; border-radius: 0.375rem;">
                                    <span style="font-weight: 500;">å ±å‘Šåˆ†é¡</span>
                                    <span>æ€§åˆ¥ãƒ»å¹´é½¢åˆ¥ãƒ»åœ°åŸŸåˆ¥</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: #f9fafb; border-radius: 0.375rem;">
                                    <span style="font-weight: 500;">å¯¾è±¡æœŸé–“</span>
                                    <span>2000å¹´ã€œ2025å¹´</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: #f9fafb; border-radius: 0.375rem;">
                                    <span style="font-weight: 500;">åœ°ç†çš„ç¯„å›²</span>
                                    <span>æ±äº¬éƒ½å…¨åŸŸ</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">ğŸ—“ï¸ å®šç‚¹ã‚µãƒ¼ãƒ™ã‚¤ãƒ©ãƒ³ã‚¹å¯¾è±¡ç–¾æ‚£ä¸€è¦§</div>
                    <div style="padding: 1rem;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                            <div>
                                <h4 style="margin-bottom: 0.75rem; color: #374151; font-weight: 600;">å‘¼å¸å™¨æ„ŸæŸ“ç—‡</h4>
                                <div style="font-size: 0.875rem; line-height: 1.5; color: #6b7280;">
                                    ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶ã€RSã‚¦ã‚¤ãƒ«ã‚¹æ„ŸæŸ“ç—‡ã€å’½é ­çµè†œç†±ã€ãƒã‚¤ã‚³ãƒ—ãƒ©ã‚ºãƒè‚ºç‚ã€ã‚¯ãƒ©ãƒŸã‚¸ã‚¢è‚ºç‚ã€ç™¾æ—¥å’³
                                </div>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 0.75rem; color: #374151; font-weight: 600;">æ¶ˆåŒ–å™¨æ„ŸæŸ“ç—‡</h4>
                                <div style="font-size: 0.875rem; line-height: 1.5; color: #6b7280;">
                                    æ„ŸæŸ“æ€§èƒƒè…¸ç‚ã€æ„ŸæŸ“æ€§èƒƒè…¸ç‚ï¼ˆãƒ­ã‚¿ã‚¦ã‚¤ãƒ«ã‚¹ï¼‰
                                </div>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 0.75rem; color: #374151; font-weight: 600;">å°å…æ„ŸæŸ“ç—‡</h4>
                                <div style="font-size: 0.875rem; line-height: 1.5; color: #6b7280;">
                                    æ‰‹è¶³å£ç—…ã€æ°´ç—˜ã€ãƒ˜ãƒ«ãƒ‘ãƒ³ã‚®ãƒ¼ãƒŠã€çªç™ºæ€§ç™ºã—ã‚“ã€å·å´ç—…ã€æµè¡Œæ€§è€³ä¸‹è…ºç‚
                                </div>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 0.75rem; color: #374151; font-weight: 600;">ãã®ä»–</h4>
                                <div style="font-size: 0.875rem; line-height: 1.5; color: #6b7280;">
                                    éº»ã—ã‚“ã€é¢¨ã—ã‚“ã€ä¼æŸ“æ€§ç´…æ–‘ã€æ€¥æ€§å‡ºè¡€æ€§çµè†œç‚ã€æµè¡Œæ€§è§’çµè†œç‚ã€ç´°èŒæ€§é«„è†œç‚ ä»–
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // å®šç‚¹ã‚µãƒ¼ãƒ™ã‚¤ãƒ©ãƒ³ã‚¹ ç–¾ç—…åˆ†æãƒ“ãƒ¥ãƒ¼
        async function renderSentinelDiseases() {
            const content = document.getElementById('main-content');
            
            try {
                // Sentinelãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–ï¼ˆæ¯å›æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ï¼‰
                content.innerHTML = '<div class="loading">å®šç‚¹ã‚µãƒ¼ãƒ™ã‚¤ãƒ©ãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
                await initializeSentinelData();

                content.innerHTML = `
                    <div class="filter-section">
                        <h3 class="chart-title">å®šç‚¹ç–¾ç—…åˆ†æè¨­å®š</h3>
                        <div class="filter-grid">
                            <div class="form-group">
                                <label class="form-label">å®šç‚¹ç›£è¦–ç–¾æ‚£</label>
                                <select id="sentinelDiseaseSelect" class="form-select">
                                    <option value="">ç–¾æ‚£ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                                    ${sentinelDiseaseList.map(disease => {
                                        const stats = sentinelSummaryData?.disease_statistics?.[disease];
                                        const totalCases = stats?.total_cases || 0;
                                        return `<option value="${disease}">${disease} (${totalCases.toLocaleString()}ç—‡ä¾‹)</option>`;
                                    }).join('')}
                                </select>
                                <div style="font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem;">
                                    â€»æ‹¬å¼§å†…ã¯å…¨æœŸé–“ã®ç´¯è¨ˆç—‡ä¾‹æ•°
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">é–‹å§‹å¹´</label>
                                <select id="sentinelStartYear" class="form-select">
                                    ${Array.from({length: 26}, (_, i) => 2000 + i).map(year => `
                                        <option value="${year}" ${year === 2020 ? 'selected' : ''}>${year}å¹´</option>
                                    `).join('')}
                                </select>
                                <div style="font-size: 0.75rem; color: transparent; margin-top: 0.25rem;">
                                    ã€€
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">çµ‚äº†å¹´</label>
                                <select id="sentinelEndYear" class="form-select">
                                    ${Array.from({length: 26}, (_, i) => 2000 + i).map(year => `
                                        <option value="${year}" ${year === 2024 ? 'selected' : ''}>${year}å¹´</option>
                                    `).join('')}
                                </select>
                                <div style="font-size: 0.75rem; color: transparent; margin-top: 0.25rem;">
                                    ã€€
                                </div>
                            </div>
                            <div class="form-group">
                                <button id="sentinelAnalyzeBtn" class="btn btn-primary" disabled>åˆ†æå®Ÿè¡Œ</button>
                                <div style="font-size: 0.75rem; color: transparent; margin-top: 0.25rem;">
                                    ã€€
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="sentinelAnalysisResults" style="display: none;">
                        <div class="metric-cards">
                            <div class="metric-card">
                                <div class="metric-value" id="sentinelTotalRecords">-</div>
                                <div class="metric-label">é€±æ¬¡å ±å‘Šæ•°</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="sentinelTotalCases">-</div>
                                <div class="metric-label">æœŸé–“å†…ç—‡ä¾‹æ•°</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="sentinelMaxWeekly">-</div>
                                <div class="metric-label">æœ€å¤§é€±é–“ç—‡ä¾‹æ•°</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="sentinelAvgWeekly">-</div>
                                <div class="metric-label">é€±å¹³å‡ç—‡ä¾‹æ•°</div>
                            </div>
                        </div>
                        
                        <div class="charts-grid">
                            <div class="chart-card" style="grid-column: 1 / -1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <div class="chart-title" id="sentinelTimeseriesTitle">å®šç‚¹ç–¾ç—…æ™‚ç³»åˆ—ã‚°ãƒ©ãƒ•</div>
                                    <div style="display: flex; gap: 1rem; align-items: center;">
                                        <div class="form-group" style="margin: 0;">
                                            <button id="sentinelSeasonalToggleBtn" class="btn btn-primary" style="font-size: 0.875rem; padding: 0.375rem 0.75rem;">
                                                å­£ç¯€æ€§æ¯”è¼ƒ
                                            </button>
                                        </div>
                                        <div class="form-group" style="margin: 0;">
                                            <select id="sentinelTimeUnitSelect" class="form-select" style="min-width: 120px;">
                                                <option value="week">é€±å˜ä½</option>
                                                <option value="month">æœˆå˜ä½</option>
                                                <option value="year">å¹´å˜ä½</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="chart-container" style="height: 400px;">
                                    <canvas id="sentinelTimeseriesChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-title">ãƒ‡ãƒ¼ã‚¿è©³ç´° (æœ€æ–°20ä»¶)</div>
                            <div style="max-height: 400px; overflow-y: auto;">
                                <table class="data-table" id="sentinelDataTable">
                                    <thead>
                                        <tr>
                                            <th>é€±</th>
                                            <th>ç”·æ€§ç—‡ä¾‹</th>
                                            <th>å¥³æ€§ç—‡ä¾‹</th>
                                            <th>åˆè¨ˆç—‡ä¾‹</th>
                                            <th>å®šç‚¹æ•°</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sentinelDataTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;

                // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                setupSentinelDiseaseAnalysisEvents();

            } catch (error) {
                content.innerHTML = `<div class="error">å®šç‚¹ç–¾ç—…åˆ†æã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}</div>`;
            }
        }

        // å®šç‚¹ç–¾ç—…åˆ†æã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
        function setupSentinelDiseaseAnalysisEvents() {
            const diseaseSelect = document.getElementById('sentinelDiseaseSelect');
            const analyzeBtn = document.getElementById('sentinelAnalyzeBtn');
            const seasonalToggleBtn = document.getElementById('sentinelSeasonalToggleBtn');
            const timeUnitSelect = document.getElementById('sentinelTimeUnitSelect');

            diseaseSelect.addEventListener('change', function() {
                analyzeBtn.disabled = !this.value;
            });

            analyzeBtn.addEventListener('click', async function() {
                const disease = diseaseSelect.value;
                const startYear = document.getElementById('sentinelStartYear').value;
                const endYear = document.getElementById('sentinelEndYear').value;

                if (!disease) return;

                this.disabled = true;
                this.textContent = 'åˆ†æä¸­...';

                try {
                    await analyzeSentinelDiseaseData(disease, startYear, endYear);
                } catch (error) {
                    alert('åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
                } finally {
                    this.disabled = false;
                    this.textContent = 'åˆ†æå®Ÿè¡Œ';
                }
            });

            // å­£ç¯€æ€§æ¯”è¼ƒãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            seasonalToggleBtn.addEventListener('click', function() {
                if (!sentinelCurrentData) {
                    alert('ã¾ãšç–¾ç—…ã‚’é¸æŠã—ã¦åˆ†æã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
                    return;
                }

                const disease = document.getElementById('sentinelDiseaseSelect').value;
                const startYear = document.getElementById('sentinelStartYear').value;
                const endYear = document.getElementById('sentinelEndYear').value;

                if (sentinelIsSeasonalMode) {
                    // å­£ç¯€æ€§æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰é€šå¸¸è¡¨ç¤ºã«æˆ»ã‚‹
                    sentinelIsSeasonalMode = false;
                    sentinelSeasonalData = null;
                    updateSentinelSeasonalToggleButton();
                    renderSentinelTimeseries(sentinelCurrentData, disease);
                } else {
                    // é€šå¸¸è¡¨ç¤ºã‹ã‚‰å­£ç¯€æ€§æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ
                    if (parseInt(startYear) === parseInt(endYear)) {
                        // åŒä¸€å¹´ã®å ´åˆã¯å­£ç¯€æ€§æ¯”è¼ƒã‚’å®Ÿè¡Œ
                        analyzeSentinelSeasonalPattern(disease, startYear);
                    } else {
                        alert('å­£ç¯€æ€§æ¯”è¼ƒã¯é–‹å§‹å¹´ã¨çµ‚äº†å¹´ã‚’åŒã˜å¹´ã«è¨­å®šã—ã¦ãã ã•ã„');
                    }
                }
            });

            // æ¨ªè»¸å˜ä½å¤‰æ›´ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            timeUnitSelect.addEventListener('change', function() {
                if (!sentinelCurrentData) return;

                const disease = document.getElementById('sentinelDiseaseSelect').value;
                
                if (sentinelIsSeasonalMode && sentinelSeasonalData) {
                    // å­£ç¯€æ€§æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
                    renderSentinelSeasonalComparisonChart(
                        sentinelSeasonalData.normalizedData,
                        sentinelSeasonalData.disease,
                        sentinelSeasonalData.years,
                        sentinelSeasonalData.targetYear
                    );
                } else {
                    // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
                    renderSentinelTimeseries(sentinelCurrentData, disease);
                }
            });
        }

        // å®šç‚¹ç–¾ç—…ãƒ‡ãƒ¼ã‚¿ã®åˆ†æå®Ÿè¡Œ
        async function analyzeSentinelDiseaseData(disease, startYear, endYear) {
            try {
                // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                let filteredData = sentinelDataset.filter(record => 
                    record.disease_name === disease &&
                    record.year >= parseInt(startYear) &&
                    record.year <= parseInt(endYear)
                );

                if (filteredData.length === 0) {
                    throw new Error('æŒ‡å®šã•ã‚ŒãŸæ¡ä»¶ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }

                // ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                sentinelCurrentData = filteredData;
                sentinelIsSeasonalMode = false;
                sentinelSeasonalData = null;

                // çµ±è¨ˆæƒ…å ±ã‚’è¨ˆç®—
                const totalCases = filteredData.reduce((sum, item) => sum + item.total_count, 0);
                const maxWeekly = Math.max(...filteredData.map(item => item.total_count));
                const avgWeekly = totalCases / filteredData.length;

                // ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°
                document.getElementById('sentinelTotalRecords').textContent = filteredData.length.toLocaleString();
                document.getElementById('sentinelTotalCases').textContent = totalCases.toLocaleString();
                document.getElementById('sentinelMaxWeekly').textContent = maxWeekly.toLocaleString();
                document.getElementById('sentinelAvgWeekly').textContent = avgWeekly.toFixed(1);

                // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
                updateSentinelSeasonalToggleButton();

                // ãƒãƒ£ãƒ¼ãƒˆã‚’æç”»
                renderSentinelTimeseries(filteredData, disease);

                // ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°
                updateSentinelDataTable(filteredData);

                // çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
                document.getElementById('sentinelAnalysisResults').style.display = 'block';

            } catch (error) {
                throw new Error(`ãƒ‡ãƒ¼ã‚¿ã®åˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
            }
        }

        // å®šç‚¹ç–¾ç—…æ™‚ç³»åˆ—ãƒãƒ£ãƒ¼ãƒˆã®æç”»
        function renderSentinelTimeseries(data, diseaseName) {
            const ctx = document.getElementById('sentinelTimeseriesChart');
            
            // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆã‚’ç ´æ£„
            if (window.sentinelChart) {
                window.sentinelChart.destroy();
            }

            // ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
            document.getElementById('sentinelTimeseriesTitle').textContent = `${diseaseName} ã®ç™ºç”Ÿå‹•å‘ï¼ˆå®šç‚¹ã‚µãƒ¼ãƒ™ã‚¤ãƒ©ãƒ³ã‚¹ï¼‰`;

            // ãƒ‡ãƒ¼ã‚¿ã‚’æ™‚ç³»åˆ—é †ã«ã‚½ãƒ¼ãƒˆ
            data.sort((a, b) => {
                if (a.year !== b.year) return a.year - b.year;
                return a.week - b.week;
            });

            // æ¨ªè»¸å˜ä½ã‚’å–å¾—
            const timeUnit = document.getElementById('sentinelTimeUnitSelect').value;
            
            // å˜ä½ã«å¿œã˜ã¦ãƒ‡ãƒ¼ã‚¿ã‚’é›†ç´„
            const { labels, values } = aggregateSentinelDataByTimeUnit(data, timeUnit);

            window.sentinelChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: diseaseName,
                        data: values,
                        borderColor: 'rgba(34, 197, 94, 1)',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        tension: 0.1,
                        fill: true,
                        pointRadius: 2,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'é€±é–“ç—‡ä¾‹æ•°'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'å ±å‘Šé€±'
                            },
                            ticks: {
                                maxTicksLimit: 20
                            }
                        }
                    }
                }
            });
        }

        // å®šç‚¹ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ›´æ–°
        function updateSentinelDataTable(data) {
            const tbody = document.getElementById('sentinelDataTableBody');
            const recentData = data.slice(-20).reverse(); // æœ€æ–°20ä»¶ã‚’é€†é †ã§è¡¨ç¤º

            tbody.innerHTML = recentData.map(item => {
                return `
                    <tr>
                        <td>${item.year}å¹´ç¬¬${item.week}é€±</td>
                        <td style="font-family: monospace; text-align: right;">${item.male_count}</td>
                        <td style="font-family: monospace; text-align: right;">${item.female_count}</td>
                        <td style="font-family: monospace; text-align: right; font-weight: 600;">${item.total_count}</td>
                        <td style="font-family: monospace; text-align: right;">${item.sentinel_points}</td>
                    </tr>
                `;
            }).join('');
        }

        // å®šç‚¹ç–¾ç—…ãƒ‡ãƒ¼ã‚¿ã®æ™‚é–“å˜ä½é›†ç´„
        function aggregateSentinelDataByTimeUnit(data, timeUnit) {
            if (timeUnit === 'week') {
                // é€±å˜ä½ã®å ´åˆã¯ãã®ã¾ã¾
                const labels = data.map(item => `${item.year}å¹´ç¬¬${item.week}é€±`);
                const values = data.map(item => item.total_count);
                return { labels, values };
            } else if (timeUnit === 'month') {
                // æœˆå˜ä½ã§é›†ç´„
                const monthlyData = {};
                data.forEach(item => {
                    const weekDate = new Date(item.year, 0, (item.week - 1) * 7 + 1);
                    const monthKey = `${item.year}-${String(weekDate.getMonth() + 1).padStart(2, '0')}`;
                    if (!monthlyData[monthKey]) {
                        monthlyData[monthKey] = 0;
                    }
                    monthlyData[monthKey] += item.total_count;
                });
                
                const labels = Object.keys(monthlyData).sort().map(key => {
                    const [year, month] = key.split('-');
                    return `${year}å¹´${month}æœˆ`;
                });
                const values = Object.keys(monthlyData).sort().map(key => monthlyData[key]);
                return { labels, values };
            } else if (timeUnit === 'year') {
                // å¹´å˜ä½ã§é›†ç´„
                const yearlyData = {};
                data.forEach(item => {
                    const yearKey = item.year;
                    if (!yearlyData[yearKey]) {
                        yearlyData[yearKey] = 0;
                    }
                    yearlyData[yearKey] += item.total_count;
                });
                
                const labels = Object.keys(yearlyData).sort().map(year => `${year}å¹´`);
                const values = Object.keys(yearlyData).sort().map(year => yearlyData[year]);
                return { labels, values };
            }
        }

        // å®šç‚¹ç–¾ç—…å­£ç¯€æ€§ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
        async function analyzeSentinelSeasonalPattern(disease, targetYear) {
            try {
                // éå»5å¹´é–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const years = [];
                const currentYear = parseInt(targetYear);
                for (let i = 4; i >= 0; i--) {
                    years.push(currentYear - i);
                }

                // å„å¹´ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const yearlyData = {};
                const allNormalizedData = [];

                for (const year of years) {
                    const yearData = sentinelDataset.filter(record => 
                        record.disease_name === disease && 
                        record.year === year
                    );

                    if (yearData.length > 0) {
                        // é€±ã”ã¨ã«æ­£è¦åŒ–ï¼ˆ1-52é€±ï¼‰
                        const weeklyData = new Array(52).fill(0);
                        yearData.forEach(record => {
                            if (record.week >= 1 && record.week <= 52) {
                                weeklyData[record.week - 1] = record.total_count;
                            }
                        });

                        yearlyData[year] = weeklyData;
                        allNormalizedData.push({
                            year: year,
                            data: weeklyData
                        });
                    }
                }

                // å­£ç¯€æ€§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                sentinelSeasonalData = {
                    disease: disease,
                    years: years,
                    targetYear: currentYear,
                    normalizedData: allNormalizedData
                };

                sentinelIsSeasonalMode = true;
                updateSentinelSeasonalToggleButton();

                // å­£ç¯€æ€§æ¯”è¼ƒãƒãƒ£ãƒ¼ãƒˆã‚’æç”»
                renderSentinelSeasonalComparisonChart(allNormalizedData, disease, years, currentYear);

            } catch (error) {
                alert('å­£ç¯€æ€§åˆ†æã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // å®šç‚¹ç–¾ç—…å­£ç¯€æ€§æ¯”è¼ƒãƒãƒ£ãƒ¼ãƒˆã®æç”»
        function renderSentinelSeasonalComparisonChart(normalizedData, diseaseName, years, targetYear) {
            const ctx = document.getElementById('sentinelTimeseriesChart');
            
            // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆã‚’ç ´æ£„
            if (window.sentinelChart) {
                window.sentinelChart.destroy();
            }

            // ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
            document.getElementById('sentinelTimeseriesTitle').textContent = `${diseaseName} ã®å­£ç¯€æ€§æ¯”è¼ƒï¼ˆå®šç‚¹ã‚µãƒ¼ãƒ™ã‚¤ãƒ©ãƒ³ã‚¹ï¼‰`;

            // ãƒ©ãƒ™ãƒ«ã‚’æº–å‚™ï¼ˆé€±ç•ªå·ï¼‰
            const labels = Array.from({length: 52}, (_, i) => `ç¬¬${i + 1}é€±`);

            // è‰²ã®ãƒ‘ãƒ¬ãƒƒãƒˆ
            const colors = [
                'rgba(59, 130, 246, 1)',   // å¯¾è±¡å¹´ï¼ˆé’ï¼‰
                'rgba(34, 197, 94, 1)',    // 1å¹´å‰ï¼ˆç·‘ï¼‰
                'rgba(245, 158, 11, 1)',   // 2å¹´å‰ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ï¼‰
                'rgba(239, 68, 68, 1)',    // 3å¹´å‰ï¼ˆèµ¤ï¼‰
                'rgba(147, 51, 234, 1)'    // 4å¹´å‰ï¼ˆç´«ï¼‰
            ];

            // ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æº–å‚™
            const datasets = normalizedData.map((yearData, index) => {
                const isTargetYear = yearData.year === targetYear;
                return {
                    label: `${yearData.year}å¹´`,
                    data: yearData.data,
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length].replace('1)', '0.1)'),
                    tension: 0.1,
                    fill: false,
                    pointRadius: isTargetYear ? 3 : 2,
                    pointHoverRadius: isTargetYear ? 6 : 4,
                    borderWidth: isTargetYear ? 3 : 2
                };
            }).reverse(); // å¯¾è±¡å¹´ã‚’å·¦ç«¯ã«é…ç½®

            window.sentinelChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'é€±é–“ç—‡ä¾‹æ•°'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'é€±ç•ªå·'
                            }
                        }
                    }
                }
            });
        }

        // å®šç‚¹ç–¾ç—…å­£ç¯€æ€§æ¯”è¼ƒãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
        function updateSentinelSeasonalToggleButton() {
            const toggleBtn = document.getElementById('sentinelSeasonalToggleBtn');
            if (sentinelIsSeasonalMode) {
                toggleBtn.textContent = 'é€šå¸¸è¡¨ç¤º';
                toggleBtn.style.backgroundColor = '#dc2626';
            } else {
                toggleBtn.textContent = 'å­£ç¯€æ€§æ¯”è¼ƒ';
                toggleBtn.style.backgroundColor = '#3b82f6';
            }
        }

        // å®šç‚¹ã‚µãƒ¼ãƒ™ã‚¤ãƒ©ãƒ³ã‚¹ åœ°åŸŸåˆ¥åˆ†æãƒ“ãƒ¥ãƒ¼
        async function renderSentinelGeographic() {
            const content = document.getElementById('main-content');
            
            content.innerHTML = `
                <div class="loading">åœ°åŸŸåˆ¥åˆ†ææ©Ÿèƒ½ã‚’å®Ÿè£…ä¸­...</div>
                <div style="padding: 2rem; text-align: center; color: #6b7280;">
                    <div style="font-size: 1.125rem; margin-bottom: 1rem;">ğŸ—ºï¸ åœ°åŸŸåˆ¥ç–«å­¦åˆ†æ</div>
                    <div>ä¿å¥æ‰€åˆ¥ãƒ»åŒ»ç™‚åœåˆ¥ãƒ‡ãƒ¼ã‚¿ã®åœ°ç†çš„åˆ†ææ©Ÿèƒ½ã‚’æº–å‚™ä¸­ã§ã™</div>
                </div>
            `;
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // Sentinelãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ï¼ˆæœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºå®Ÿã«èª­ã¿è¾¼ã‚€ãŸã‚ï¼‰
            sentinelDataset = null;
            sentinelSummaryData = null;
            sentinelDiseaseList = [];
            
            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    currentView = this.dataset.view;
                    renderView(currentView);
                });
            });
            
            renderView('overview');
        });
    </script>
</body>
</html>